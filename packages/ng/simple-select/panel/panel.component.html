<div
	class="lu-picker-panel lu-option-picker-panel"
	cdkTrapFocus
	*ngIf="{
		options: (options$ | async) || [],
		groupTemplateLocation: groupTemplateLocation$ | async,
		clue: clueChange$ | async,
	} as ctx"
	[cdkTrapFocusAutoCapture]="true"
>
	<div class="lu-picker-content" [class.is-loading]="loading$ | async" (scroll)="onScroll($event)">
		<div role="listbox">
			<ng-container *ngIf="grouping && ctx.groupTemplateLocation === 'group-header'">
				<div
					*ngFor="let group of ctx.options | luOptionGroup:grouping.selector"
					class="lu-picker-content-option-group"
					role="group"
					[attr.aria-labelledby]="selectId + '-group-' + group.key"
				>
					<span class="lu-picker-content-option-group-title" role="presentation" [id]="selectId + '-group-' + group.key">
						<ng-container *luPortal="grouping.content; context: { $implicit: group }" />
					</span>
					<ng-template [ngTemplateOutlet]="optionsList" [ngTemplateOutletContext]="{ $implicit: group.options }" />
				</div>
			</ng-container>
			<ng-container *ngIf="!grouping || ctx.groupTemplateLocation !== 'group-header'">
				<ng-template [ngTemplateOutlet]="optionsList" [ngTemplateOutletContext]="{ $implicit: ctx.options }" />
			</ng-container>

			<ng-template #optionsList let-options>
				<lu-select-option
					*ngFor="let option of options; let index = index"
					[option]="option"
					[optionTpl]="optionTpl"
					[optionIndex]="index"
					[grouping]="ctx.groupTemplateLocation === 'option' ? grouping : undefined"
					[scrollIntoViewOptions]="{ block: 'center' }"
					[isSelected]="option | luIsOptionSelected:optionComparer:selected"
					(click)="panelRef.emitValue(option)"
				/>
			</ng-template>
			<div class="lu-picker-content-option-emptyState" *ngIf="ctx.options.length === 0 && (loading$ | async) === false">
				{{intl.emptyResults}}
			</div>
		</div>
		<div *ngIf="loading$ | async" class="lu-picker-content-loading">
			<div class="loading"></div>
			<span>{{intl.loading}}</span>
		</div>
		<div class="lu-picker-content-add" *ngIf="selectInput.addOption.observed && ctx.clue">
			<button class="button mod-text mod-icon palette-product" type="button" (click)="addOption(ctx.clue)">
				<span aria-hidden="true" class="lucca-icon icon-mathsPlus"></span>
				<ng-container *luPortal="selectInput.addOptionLabel" />
			</button>
		</div>
	</div>
</div>
