<div
	class="fileUpload"
	[class.mod-droppable]="droppable"
	[class.is-loading]="state() === 'loading'"
	[class.is-critical]="state() === 'critical'"
	[class.mod-S]="size() === 'S'"
	[class.is-hidden]="!multiple && files.length > 0"
>
	<input
		[attr.aria-describedby]="'fileUpload-instruction-' + idSuffix"
		[attr.multiple]="multiple ? 'multiple' : null"
		class="fileUpload-input"
		type="file"
		title=""
		[attr.accept]="acceptAttribute().length > 0 ? acceptAttribute() : null"
		luInput
		(dragenter)="droppable = true"
		(dragleave)="droppable = false"
		(change)="filesChange($event)"
		#inputRef
	/>
	@switch (state()) { @case ('loading') {
	<div class="fileUpload-status">
		@if (!disablePreview() && !multiple && bitmapPreviews.length > 0) {
		<div class="fileUpload-status-preview">
			<img class="fileUpload-status-preview-img" [src]="bitmapPreviews[0]" alt="" />
		</div>
		}
		<div class="fileUpload-status-loading loading"></div>
	</div>
	} @default {
	<div class="fileUpload-status" [innerHtml]="illustration() | luSafeExternalSvg"></div>
	}}
	<div class="fileUpload-instruction" [attr.id]="'fileUpload-instruction-' + idSuffix">
		<span class="fileUpload-instruction-action" aria-hidden="true">
			@if (multiple) { Déposez les fichiers ici ou
			<span class="fileUpload-instruction-action-click">cliquez pour les sélectionner</span>. } @else { Déposez le fichier ici ou
			<span class="fileUpload-instruction-action-click">cliquez pour le sélectionner</span>. }
		</span>
		@if (acceptNames().length) {
		<span class="fileUpload-instruction-formats">
			@if (acceptNames().length > 1) {Formats acceptés :} @else { Format accepté : } {{acceptNames().join(', ')}}.
		</span>
		} @if (fileMaxSize()) {
		<span class="fileUpload-instruction-size">Poids maximum@if (multiple) { d’un fichier } : {{ maxSizeDisplay() }}. </span>
		}
	</div>

	<span class="fileUpload-button button" aria-hidden="true"
		>@if (multiple) { Sélectionner des fichiers } @else { Sélectionner un fichier }</span
	>
	@if (state() === 'loading' && !multiple && size() !== 'S') {
	<ul class="fileUpload-toolbar">
		<!--
	<li>
	<button type="button" luButton="text" luTooltip="Modifier" luTooltipOnlyForDisplay>
		<lu-icon icon="officePen" alt="Modifier" size="S" />
	</button>
	</li>
	-->
		<!-- TODO: click -->
		<!--
		<li>
			<button type="button" luButton="text" luTooltip="Modifier" luTooltipOnlyForDisplay>
				<lu-icon icon="officePen" alt="Modifier" size="S" />
			</button>
		</li>
		-->
		<!-- TODO: click -->
		<li>
			<button type="button" luButton="text" luTooltip="Supprimer" luTooltipOnlyForDisplay (click)="abort(inputRef)">
				<lu-icon icon="trashDelete" alt="Supprimer le fichier « {{files[0].name}} »" size="S" />
			</button>
		</li>
	</ul>
	}
</div>
@for (file of files; track file.name; let index = $index) {
<lu-file-uploaded
	[fileUrl]="bitmapPreviews[index]"
	[size]="size()"
	[fileName]="file.name"
	[fileFormat]="file.type"
	[fileSize]="file.size"
	(deleteFile)="abort(inputRef)"
	[typeMedia]="typeMedia()"
/>
}
