<!-- TODO : il faudrait remplacer la classe is-expanded par un attribut aria-expanded="true"-->
<div class="lu-picker-panel lu-option-picker-panel lu-multiselect-panel mod-multiple" role="dialog" cdkTrapFocus
	*ngIf="{ options: options$ | async } as ctx" [cdkTrapFocusAutoCapture]="true" [class.is-expanded]="isExpanded"
	[attr.aria-expanded]="isExpanded ? 'true' : undefined">
	<div class="form lu-multiselect-panel-form">
		<ng-container *ngIf="searchable">
			<label class="panel-search textfield mod-search mod-outlined lu-multiselect-search">
				<input #searchInput class="textfield-input" [(ngModel)]="search" (ngModelChange)="updateClue($event)"
					[ngModelOptions]="{ standalone: true }" />
				<span class="u-mask textfield-label">%%Rechercher </span>
			</label>
		</ng-container>
		<button class="button mod-text mod-icon lu-multiselect-expandbutton" type="button"
			(click)="isExpanded = !isExpanded">
			<span aria-hidden="true" class="lucca-icon" [class.icon-fullscreen]="!isExpanded"
				[class.icon-fullscreenExit]="isExpanded"></span>
			{{ isExpanded ? intl.reduce : intl.expand }}
		</button>
	</div>
	<div class="lu-multiselect-panel-columns">
		<div class="lu-multiselect-panel-columns-col1" (keydown)="onLeftColumnKeydown($event)">
			<div class="lu-picker-content lu-multiselect-panel-columns-col1-content"
				[class.is-loading]="loading$ | async" tabindex="0" cdkFocusInitial role="list"
				aria-multiselectable="true" (scroll)="onScroll($event)">
				<ng-container *ngIf="searchable">
					<div class="optionPlaceholder" *ngIf="search && !ctx.options?.length">
						<p class="optionPlaceholder-content u-marginBottom0">{{ intl.emptyResults }}</p>
						<button type="button" class="link"
							(click)="updateClue(null); searchInput.nativeElement.focus()">{{ intl.clearSearch }}</button>
					</div>
				</ng-container>

				<ng-container *ngIf="canSelectAll">
					<label class="checkbox lu-multiselect-selectall" role="option" [for]="selectId + '-select-all'">
						<input class="checkbox-input" type="checkbox"
							[class.is-incomplete]="(areAllOptionsSelected$ | async) !== true && selectedOptions.length"
							[id]="selectId + '-select-all'"
							[ngModel]="(areAllOptionsSelected$ | async) === true || !!selectedOptions.length"
							(ngModelChange)="toggleAll($event)" />
						<span class="checkbox-label">{{ intl.selectAll }}</span>
					</label>
				</ng-container>

				<lu-select-option *ngFor="let option of ctx.options; let index = index" [option]="option"
					[optionTpl]="optionTpl" [optionIndex]="index" [scrollIntoViewOptions]="{ block: 'nearest' }"
					[isSelected]="option | luIsOptionSelected:optionComparer:selectedOptions"
					(click)="toggleOption(option)"></lu-select-option>

				<div *ngIf="loading$ | async" class="panel-loading loading lu-picker-loading"></div>
			</div>
		</div>
		<div class="lu-multiselect-panel-columns-col2" *ngIf="isExpanded">
			<div class="lu-multiselect-emptystate" *ngIf="!selectedOptions.length">%%empty</div>
			<div class="lu-multiselect-chips" role="listbox" tabindex="0" *ngIf="selectedOptions.length"
				(keydown)="onRightColumnKeydown($event)">
				<div role="option" class="chip lu-multiselect-chip" *ngFor="let option of selectedOptions"
					[luMultiSelectSelectedChip]="option">
					<ng-container *luOptionOutlet="optionTpl; value: option"></ng-container>
					<button type="button" class="chip-kill lu-multiselect-chip-kill" tabindex="-1"
						(click)="onChipKillClick(option)"></button>
				</div>
			</div>
			<button *ngIf="selectedOptions.length" class="lu-multiselect-clear button mod-text mod-icon" type="button"
				(click)="clear()">
				<span aria-hidden="true" class="lucca-icon icon-trash"></span>
				{{ intl.clear }}
			</button>
		</div>
	</div>
</div>